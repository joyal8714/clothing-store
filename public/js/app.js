document.addEventListener('DOMContentLoaded',()=>{const t=document.getElementById("product-grid"),e=document.getElementById("page-title"),o=document.getElementById("product-modal");let i=[];const d=async()=>{try{const d=await fetch("/api/products");i=await d.json();const n=new URLSearchParams(window.location.search).get("category");c(n)}catch(l){console.error("Failed to load products:",l),t.innerHTML="<p>Error loading products. Please try again later.</p>"}},c=c=>{let n=i;c?(n=i.filter(t=>t.category.toLowerCase()===c.toLowerCase()),e.textContent=`${c.charAt(0).toUpperCase()+c.slice(1)}'s Collection`):e.textContent="Our Latest Collection",t.innerHTML="",n.forEach(e=>{const i=document.createElement("div");i.className="product-card",i.dataset.productId=e.id,i.innerHTML=`<img src="${e.images[0]}" alt="${e.title}" class="product-image"><div class="product-info"><h3 class="product-title">${e.title}</h3><p class="product-description">${e.description.substring(0,100)}...</p><div class="product-footer"><span class="product-price">₹${e.price}</span></div></div>`,i.addEventListener("click",()=>l(e.id)),t.appendChild(i)})};const n=document.getElementById("modal-image-slider"),s=document.getElementById("modal-title"),a=document.getElementById("modal-description"),r=document.getElementById("modal-price");let m=0,u=[];const l=t=>{const e=i.find(e=>e.id===t);e&&(u=e.images,m=0,s.textContent=e.title,a.textContent=e.description,r.textContent=`₹${e.price}`,p(),o.style.display="flex",document.body.style.overflow="hidden")},y=()=>{o.style.display="none",document.body.style.overflow="auto"},p=()=>{n.innerHTML=u.map(t=>`<img src="${t}" alt="${s.textContent}">`).join(""),n.style.transform=`translateX(-${100*m}%)`,document.getElementById("slider-prev-btn").style.display=u.length>1?"block":"none",document.getElementById("slider-next-btn").style.display=u.length>1?"block":"none"},h=()=>{m=(m+1)%u.length,p()},f=()=>{m=(m-1+u.length)%u.length,p};document.getElementById("modal-close-btn").addEventListener("click",y),o.addEventListener("click",t=>t.target===o&&y()),document.getElementById("slider-next-btn").addEventListener("click",h),document.getElementById("slider-prev-btn").addEventListener("click",f),document.addEventListener("keydown",t=>{if("flex"===o.style.display){if("Escape"===t.key)y();if("ArrowRight"===t.key)h();if("ArrowLeft"===t.key)f()}}),d()});
